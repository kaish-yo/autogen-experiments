# 12.TypeScriptでのCLIツール開発

### 12.TypeScriptでのCLIツール開発

Command Line Interface（CLI）ツールは、プログラムやスクリプトをコマンドラインから実行するためのインターフェースであり、開発者にとって強力なツールです。この章では、TypeScriptを使用したCLIツールの開発過程を詳しく説明します。具体的な手法、ツール、実践的なコーディング例を通じて、TypeScriptでのCLIツール開発の技法を探求します。

#### 12.1 CLIツールの設計

CLIツールを設計する際は、以下の要素を考慮する必要があります。

- **目的**: ツールが解決する問題や提供する機能を明確にします。
- **インターフェース**: コマンドのオプションや引数の構造を定義し、ユーザーが使いやすい設計にします。
- **エラーハンドリング**: ユーザーが誤った入力をした場合のエラーメッセージや挙動を事前に考慮します。

#### 12.2 TypeScriptのセットアップ

TypeScriptでCLIツールを開発するためには、Node.jsの環境が必要です。以下の手順でセットアップを行います。

1. **Node.jsのインストール**: Node.jsをインストールします。

2. **プロジェクトの作成**:
   ```bash
   mkdir my-cli-tool
   cd my-cli-tool
   npm init -y
   ```

3. **TypeScriptのインストール**:
   ```bash
   npm install typescript --save-dev
   npx tsc --init
   ```

4. **型定義のインストール**: CLIツールを作成するために役立つ型定義をインストールします。
   ```bash
   npm install @types/node --save-dev
   ```

#### 12.3 コマンドライン引数の取得

Node.jsの`process.argv`を使用することで、コマンドライン引数を取得できます。TypeScriptでこれを活用する方法を示します。

```typescript
// cli.ts
const args = process.argv.slice(2); // 最初の2つの要素はノードとスクリプト名
console.log("Arguments:", args);
```

このスクリプトを実行すると、コマンドラインから渡された引数が表示されます。

```bash
tsc cli.ts && node cli.js arg1 arg2
```

#### 12.4 コマンドのパース

CLIアプリケーションでは、引数を解析してコマンドやオプションに適切に対応する必要があります。`yargs`や`commander`などのライブラリを用いると、引数解析が簡単になります。

以下は、`yargs`を使用した例です。

```bash
npm install yargs
```

```typescript
import yargs from 'yargs';

const argv = yargs
    .command('greet <name>', 'Greet the person', {
        // オプション
        age: {
            describe: 'Your age',
            type: 'number'
        }
    })
    .help()
    .argv;

console.log(`Hello, ${argv.name}!`);
if (argv.age) {
    console.log(`You are ${argv.age} years old.`);
}
```

このスクリプトは引数を解析し、`greet`コマンドが指定された場合に対象者に挨拶します。

#### 12.5 CLIツールの実行とエラーハンドリング

CLIツールに対する入力が無効な場合のエラーハンドリングは重要です。TypeScriptを使用して型安全なエラーメッセージを表示すると、ユーザー体験が向上します。

```typescript
if (!argv.name) {
    console.error("Error: Name is required.");
    process.exit(1); // エラーコード1でプロセスを終了
}
```

このようにすると、必須の引数がない場合に明確なエラーを提示することができます。

#### 12.6 結果の出力

CLIツールでは、データをわかりやすく表示することも重要です。TypeScriptで型付けされたデータをJSON形式で出力することで、より見やすくなります。

```typescript
const result = {
    message: `Hello, ${argv.name}!`,
    age: argv.age || 'unknown'
};

console.log(JSON.stringify(result, null, 2)); // 整形された出力
```

#### 12.7 Pythonとの比較

PythonでもCLIツールを簡単に作成できると同様に、`argparse`モジュールを使用することで引数を扱います。以下にPythonでのシンプルなCLIツールの例を示します。

```python
import argparse

parser = argparse.ArgumentParser(description='Greet a person')
parser.add_argument('name', type=str, help='Name of the person')
parser.add_argument('--age', type=int, help='Age of the person', default=None)

args = parser.parse_args()
print(f"Hello, {args.name}!")
if args.age is not None:
    print(f"You are {args.age} years old.")
```

Pythonも非常に直感的であり、TypeScriptと同様に簡単にCLIツールを作成できますが、動的型付けであるため、型安全性がTypeScriptほど強化されていません。

#### 12.8 まとめ

TypeScriptを使用したCLIツール開発は、型安全性が確保されているため、エラーの少ない堅牢なツールを作成することができます。本章では、CLIツールの設計から具体的な実装例、エラーハンドリングまでを網羅しました。続く章では、TypeScriptを使用して型安全なデータ処理の手法を探求していきます。


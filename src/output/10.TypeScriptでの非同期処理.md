# 10.TypeScriptでの非同期処理

### 10.TypeScriptでの非同期処理

非同期処理は、現代のウェブアプリケーションにおいて不可欠な要素です。TypeScriptはJavaScriptのスーパーセットであるため、非同期処理のための様々な機能を提供しています。この章では、TypeScriptにおける非同期処理の基本概念、Promise、async/awaitの使い方、および非同期処理の際の型安全性について説明します。

#### 10.1 非同期処理の基本

非同期処理とは、プログラムが特定のタスクを実行している間に、他のタスクも実行できるようにする手法です。この手法を用いることで、UIの応答性を保ちながら、データの取得や処理を行うことができます。

非同期処理は、以下のような場面で要求されます：

- ネットワークを介したデータの取得（APIコールなど）
- データベースへのクエリ
- 時間のかかる計算や処理

#### 10.2 Promiseによる非同期処理

TypeScriptでは、Promiseを用いて非同期処理を扱います。Promiseは、非同期処理の結果を表現し、その完了を待機するためのオブジェクトです。Promiseは、成功時の結果や失敗時のエラーを持つことができます。

##### Promiseの基本的な使用法
以下は、Promiseを使用して非同期操作を行う例です。

```typescript
function fetchData(): Promise<string> {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const data = "Data fetched!";
            resolve(data);
        }, 2000);
    });
}

fetchData().then(result => {
    console.log(result); // 2秒後に"Data fetched!"と出力される
}).catch(error => {
    console.error(error);
});
```

この例では、`fetchData`関数がPromiseを返し、2秒後にデータを取得します。`then`メソッドを使って、成功時の処理を定義しています。

#### 10.3 async/awaitによる非同期処理

async/awaitは、Promiseを使った非同期処理をさらにシンプルに記述するための構文です。`async`キーワードを付けることで、非同期関数を定義し、その中で`await`キーワードを使用することができます。

##### async/awaitの基本的な使用法
以下は、async/awaitを使用した非同期操作の例です。

```typescript
async function getData() {
    try {
        const result = await fetchData();
        console.log(result); // 2秒後に"Data fetched!"と出力される
    } catch (error) {
        console.error(error);
    }
}

getData();
```

この例では、`getData`関数を`async`として定義すると、関数内で`await`を用いてPromiseの完了を待機できます。

#### 10.4 非同期処理の型安全性

TypeScriptでは、Promiseを返す関数の型を明示的に指定することで、非同期処理の型安全性を確保できます。Promiseの型を指定することで、エラーや不整合を防ぎ、開発者が安心して非同期コードを書くことができます。

##### Promise型の明示的な指定
以下は、Promiseの戻り値に型を指定する例です。

```typescript
function fetchData(): Promise<number> {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve(42); // ここで数値を返す
        }, 2000);
    });
}

async function getData() {
    const result: number = await fetchData();
    console.log(result); // 42
}
```

このように、Promiseが返す値の型を指定することで、コードの可読性と安全性が向上します。

#### 10.5 エラーハンドリング

非同期処理においてエラーハンドリングは非常に重要です。Promiseでは、`catch`メソッドを使ってエラーをキャッチすることができます。また、async/awaitとの組み合わせで、`try/catch`ステートメントを使用することもできます。

```typescript
async function getDataWithErrorHandling() {
    try {
        const result = await fetchData();
        console.log(result);
    } catch (error) {
        console.error("Error occurred:", error);
    }
}
```

#### 10.6 Pythonとの対比

Pythonでも非同期処理は重要で、`asyncio`ライブラリや`async/await`文法を利用して非同期処理を簡潔に記述できます。Pythonにおける非同期処理の基本的な例を示します。

```python
import asyncio

async def fetch_data():
    await asyncio.sleep(2)
    return "Data fetched!"

async def get_data():
    result = await fetch_data()
    print(result)

asyncio.run(get_data())
```

Pythonにおいても、TypeScript同様に非同期関数の定義と`await`を使用することで非同期処理が表現できますが、TypeScriptの型システムが持つ型安全性の恩恵は異なっています。

#### 10.7 まとめ

TypeScriptにおける非同期処理は、主にPromiseとasync/awaitを用いて実現されます。これにより、非同期操作を容易に扱うことができ、型安全性を確保しながら開発を進めることが可能です。次の章では、型安全なAPI設計について探求していきます。


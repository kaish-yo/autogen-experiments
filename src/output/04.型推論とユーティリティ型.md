# 04.型推論とユーティリティ型

### 04.型推論とユーティリティ型

TypeScriptの型システムの中でも特に重要な機能の一つが型推論です。この機能により、開発者は明示的に型を指定しなくても、TypeScriptが自動的に変数や関数の型を推測します。また、ユーティリティ型は、TypeScriptの型を組み合わせたり、変更したりするための便利なツールです。この章では、型推論とユーティリティ型の役割と実用例を学びながら、Pythonとの対比も行います。

#### 4.1 型推論とは

型推論は、変数が初期化される際に、その値に基づいてTypeScriptが自動的に型を決定する機能です。これにより、開発者は冗長な型指定を避け、より簡潔なコードを書くことができます。

##### 基本的な型推論の例
```typescript
let message = "Hello, World!"; // messageは自動的にstring型となる
let count = 5; // countは自動的にnumber型となる
```

開発者が明示的に型を指定しなくても、TypeScriptは初期値から型を推測します。

##### Pythonとの対比
Pythonも動的型付けの言語であり、変数の値に基づいて型が決まりますが、Pythonの型は実行時に判断されるため、潜在的なエラーが発生しやすいです。TypeScriptの型推論は、コンパイル時に型の確認を行い、エラーを早期に検出することができます。

```python
message = "Hello, World!"  # Pythonでもmessageはstring型として扱われる
count = 5  # countはint型として扱われる
```

#### 4.2 型推論の応用

型推論は単に変数に対してだけでなく、関数やオブジェクトのプロパティでも利用されます。

##### 関数の推論
TypeScriptは、関数のパラメータと戻り値の型を推論できます。

```typescript
function add(a: number, b: number) {
    return a + b; // 戻り値は自動的にnumber型と推論される
}
```

##### オブジェクトのプロパティ
オブジェクトを初期化する際も型が推論されます。

```typescript
const user = {
    name: "Alice",
    age: 30
}; // userは{ name: string, age: number }型として扱われる
```

##### Pythonとの対比
Pythonでは、関数のパラメータや戻り値に型ヒントを使用して型を示すことができますが、実行時のチェックはありません。

```python
def add(a: int, b: int) -> int:
    return a + b
```

#### 4.3 ユーティリティ型とは

TypeScriptには、型を操作するためのユーティリティ型が組み込まれています。これらの型を使うことで、既存の型から新しい型を生成したり、型の一部を変更したりできます。

##### 例: Partial
Partialユーティリティ型は、すべてのプロパティをオプショナルにします。

```typescript
interface User {
    name: string;
    age: number;
}

// Userを部分的に扱う場合
function updateUser(user: User, updates: Partial<User>) {
    return { ...user, ...updates };
}
```

##### 例: Required
Requiredユーティリティ型は、すべてのプロパティを必須にします。

```typescript
type UserWithRequired = Required<Partial<User>>;
```

##### 例: Readonly
Readonlyユーティリティ型は、オブジェクトのすべてのプロパティを読み取り専用にします。

```typescript
const readonlyUser: Readonly<User> = { name: "Alice", age: 30 };
// readonlyUser.age = 31; // エラー: 'age'は読み取り専用です。
```

#### 4.4 ユーティリティ型の実用例

ユーティリティ型を使うことで、複雑なデータ構造を扱う際に役立ちます。例えば、APIレスポンスの型を利用して、特定のプロパティのみを更新したり、部分的なデータを受け取ったりする場合に便利です。

```typescript
interface ApiResponse {
    success: boolean;
    data?: User;
    error?: string;
}

// オプショナルなプロパティを持つアップデート関数
function handleApiResponse(response: ApiResponse): void {
    if (response.success) {
        console.log(response.data?.name);
    } else {
        console.error(response.error);
    }
}
```

#### 4.5 Pythonとの対比

Pythonでも型操作は可能ですが、型システムはTypeScriptほど強力ではありません。Pythonではtypingモジュールを使用することで、似たような機能を持つことができますが、その柔軟性はTypeScriptのユーティリティ型ほど洗練されていません。

##### Pythonの例
```python
from typing import TypedDict

class User(TypedDict):
    name: str
    age: int

def update_user(user: User, updates: dict) -> User:
    user.update(updates)
    return user
```

#### 4.6 まとめ

型推論はTypeScriptにおける重要な機能であり、冗長な型宣言を避けつつ、安全性を保持します。さらに、ユーティリティ型は型の操作を容易にし、開発者が効率的に型を管理できるようにします。これらの機能を理解し、活用することで、TypeScriptをより強力なツールとして利用できます。次の章では、関数型プログラミングとTypeScriptの関係について掘り下げていきます。

